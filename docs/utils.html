---

title: Utils


keywords: fastai
sidebar: home_sidebar

summary: "Useful functions to reshape/arrange/reduce raw data into clean data to add to the record"
description: "Useful functions to reshape/arrange/reduce raw data into clean data to add to the record"
nb_path: "01_utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Synchronisation-utils">Synchronisation utils<a class="anchor-link" href="#Synchronisation-utils"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extend_sync_timepoints" class="doc_header"><code>extend_sync_timepoints</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L30" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extend_sync_timepoints</code>(<strong><code>timepoints</code></strong>:<code>ndarray</code>, <strong><code>signals</code></strong>:<code>ndarray</code>, <strong><code>up_bound</code></strong>, <strong><code>low_bound</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Extend arrays of timepoints and signals (with identical shape) from the low_bound up to the up_bound.
For example, the first timepoint could be 2000, and with a low_bound of 0, it would add the
timepoints 0, 500, 1000, 1500 if the timepoint distance is of 500 (obtained by averaging the timepoints
distances).</p>
<p>params:</p>

<pre><code>- timepoints: Timepoints to extend
- signals: Signals to extend
- up_bound: Up bound to which to extend both timepoints and signals
- low_bound: Low bound to which to extend both timepoints and signals

</code></pre>
<p>returns:</p>

<pre><code>- timepoint: Extended timepoints
- signals: The datachunk array is not modified, but the idx attribute is increased by the number
of frames added with the low_bound.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="align_sync_timepoints" class="doc_header"><code>align_sync_timepoints</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L68" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>align_sync_timepoints</code>(<strong><code>timepoints</code></strong>:<a href="/theonerig/core.html#DataChunk"><code>DataChunk</code></a>, <strong><code>signals</code></strong>:<a href="/theonerig/core.html#DataChunk"><code>DataChunk</code></a>, <strong><code>ref_timepoints</code></strong>:<a href="/theonerig/core.html#DataChunk"><code>DataChunk</code></a>, <strong><code>ref_signals</code></strong>:<a href="/theonerig/core.html#DataChunk"><code>DataChunk</code></a>)</p>
</blockquote>
<p>Align the signals of a timepoints timeserie to a reference ref_timepoints with the corresponding
ref_signals. ref_timepoints is extended to match ref_timepoints lenght.</p>
<p>params:</p>

<pre><code>- timepoints: timepoints to align
- signals: signals to align
- ref_timepoints: reference timepoints
- ref_signals: reference signals

</code></pre>
<p>return:</p>

<pre><code>- Aligned timepoints (DataChunk)
- Aligned signals (DataChunk)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="resample_to_timepoints" class="doc_header"><code>resample_to_timepoints</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L133" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>resample_to_timepoints</code>(<strong><code>timepoints</code></strong>:<code>ndarray</code>, <strong><code>data</code></strong>:<code>ndarray</code>, <strong><code>ref_timepoints</code></strong>:<a href="/theonerig/core.html#DataChunk"><code>DataChunk</code></a>, <strong><code>group</code></strong>=<em><code>'data'</code></em>)</p>
</blockquote>
<p>Resample the data at timepoints to new timepoints given by ref_timepoints.
Return a DataChunk of the resampled data belonging to a specified group.</p>
<p>params:</p>

<pre><code>- timepoints: Original timepoints of the data
- data: Data to resample of shape (t, ...)
- ref_timepoints: Target timepoints for the resampling
- group: Group assigned to the returned DataChunk

</code></pre>
<p>return:</p>

<pre><code>- Resampled datachunk with appropriate idx.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="link_sync_timepoints" class="doc_header"><code>link_sync_timepoints</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L171" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>link_sync_timepoints</code>(<strong><code>frame_tp_1</code></strong>, <strong><code>frame_sig_1</code></strong>, <strong><code>frame_tp_2</code></strong>, <strong><code>frame_sig_2</code></strong>)</p>
</blockquote>
<p>Creates timepoints between two timepoints array sampled at the same rate.
This is usefull for the LED dome which cannot generate frames in between stimuli (due to ROM update)</p>
<p>params:</p>

<pre><code>- frame_tp_1: Timepoints of the first part
- frame_sig_1: Signals of the first part
- frame_tp_2: Timepoints of the second part
- frame_sig_2: Signals of the second part
</code></pre>
<p>return:</p>

<pre><code>- (concatenated_frame_timepoints, concatenated_frame_signals)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="flip_stimulus" class="doc_header"><code>flip_stimulus</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L198" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>flip_stimulus</code>(<strong><code>stim_inten</code></strong>, <strong><code>ud_inv</code></strong>, <strong><code>lr_inv</code></strong>)</p>
</blockquote>
<p>Flip QDSpy stimuli arrays to match the up/down left/right orientation of the stimulus displayed to
the mouse.</p>
<p>params:</p>

<pre><code>- stim_inten: Stimulus matrix to flip of shape (t, color, y, x)
- ud_inv: Up down inversion boolean (1 to make the flip, 0 for no operation)
- lr_inv: Up down inversion boolean (1 to make the flip, 0 for no operation)

</code></pre>
<p>return:</p>

<pre><code>- Flipped stimulus array</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="flip_gratings" class="doc_header"><code>flip_gratings</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L220" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>flip_gratings</code>(<strong><code>stim_shader</code></strong>, <strong><code>ud_inv</code></strong>, <strong><code>lr_inv</code></strong>)</p>
</blockquote>
<p>Flip gratings to match the up/down left/right orientation of the stimulus displayed to
the mouse. A grating is encoded by an array of shape (t, 3(size, angle, speed)).
Therefore the angles of the grating are modified to encode the "flipped" grating.</p>
<p>params:</p>

<pre><code>- stim_shader: Grating matrix to flip of shape (t, 3(size, angle(degree), speed))
- ud_inv: Up down inversion boolean (1 to make the flip, 0 for no operation)
- lr_inv: Up down inversion boolean (1 to make the flip, 0 for no operation)

</code></pre>
<p>return:</p>

<pre><code>- Flipped grating array</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="stim_to_dataChunk" class="doc_header"><code>stim_to_dataChunk</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L241" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>stim_to_dataChunk</code>(<strong><code>stim_inten</code></strong>, <strong><code>stim_start_idx</code></strong>, <strong><code>reference</code></strong>:<a href="/theonerig/core.html#DataChunk"><code>DataChunk</code></a>)</p>
</blockquote>
<p>Factory function for DataChunk of a stimulus, that squeeze the stim_inten matrix.</p>
<p>params:</p>

<pre><code>- stim_inten: Stimulus matrix of shape (t, ...)
- stim_start_idx: Starting frame index of the stimulus
- reference: DataChunk signal reference used to determine the starting index of the stimulus

</code></pre>
<p>return:</p>

<pre><code>- Datachunk of the stimulus</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="phy_results_dict" class="doc_header"><code>phy_results_dict</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L256" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>phy_results_dict</code>(<strong><code>phy_dir</code></strong>)</p>
</blockquote>
<p>Open the result arrays of spike sorting after manual merging with phy.</p>
<p>params:</p>

<pre><code>- phy_dir: path to the phy results

</code></pre>
<p>return:</p>

<pre><code>- Dictionnary of the phy arrays (amplitudes, channel_map, channel_positions, spike_clusters,
spike_templates, spike_times, templates)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="spike_to_dataChunk" class="doc_header"><code>spike_to_dataChunk</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L281" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>spike_to_dataChunk</code>(<strong><code>spike_timepoints</code></strong>, <strong><code>ref_timepoints</code></strong>:<a href="/theonerig/core.html#DataChunk"><code>DataChunk</code></a>)</p>
</blockquote>
<p>Factory function of a DataChunk for spiking count of cells from spike timepoints.</p>
<p>params:</p>

<pre><code>- spike_timepoints: Dictionnary of the cells spike timepoints (list)
- ref_timepoints: Reference DataChunk to align the newly created spike count Datachunk

</code></pre>
<p>return:</p>

<pre><code>- Spike count datachunk of shape (t, n_cell)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_calcium_stack_lenghts" class="doc_header"><code>get_calcium_stack_lenghts</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L307" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_calcium_stack_lenghts</code>(<strong><code>folder</code></strong>)</p>
</blockquote>
<p>Function to extract calcium stack lenghts from imageJ macro files associated to the stacks.</p>
<p>params:</p>

<pre><code>- folder: path of the folder containing the IJ macros files

</code></pre>
<p>return:</p>

<pre><code>- list of stack lenghts</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="twoP_dataChunks" class="doc_header"><code>twoP_dataChunks</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L325" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>twoP_dataChunks</code>(<strong><code>ref_timepoints</code></strong>:<a href="/theonerig/core.html#DataChunk"><code>DataChunk</code></a>, <strong><code>frame_timepoints</code></strong>, <strong><code>len_epochs</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>
<p>Factory function for two photon data.</p>
<p>params:</p>

<pre><code>- ref_timepoints: Reference timepoints to create the DataChunk
- frame_timepoints: List of frame timepoints for each sequence of two photon frame recorded.
- len_epochs: Lenght of the recorded epochs (&lt;= than the corresponding frame_timepoints). Int of list
- args: matrices of all frames detected by CaImAn. (give as many as you want to synchronise)

</code></pre>
<p>return:</p>

<pre><code>- tuple containing the synchronised matrices in the order it was given</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Modelling-utils">Modelling utils<a class="anchor-link" href="#Modelling-utils"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="img_2d_fit" class="doc_header"><code>img_2d_fit</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L358" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>img_2d_fit</code>(<strong><code>shape</code></strong>, <strong><code>param_d</code></strong>, <strong><code>f</code></strong>)</p>
</blockquote>
<p>Helper function to generate the 2D image of a fit.</p>
<p>params:</p>

<pre><code>- shape: Shape of the image in (y, x).
- param_d: Fit dictionnary.
- f: Function used of the fit.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fill_nan" class="doc_header"><code>fill_nan</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L372" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fill_nan</code>(<strong><code>A</code></strong>)</p>
</blockquote>
<p>Fill nan values with interpolation. Credits to BRYAN WOODS@StackOverflow</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Processing-utils">Processing utils<a class="anchor-link" href="#Processing-utils"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="stim_inten_norm" class="doc_header"><code>stim_inten_norm</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L383" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>stim_inten_norm</code>(<strong><code>stim_inten</code></strong>)</p>
</blockquote>
<p>Normalize a stimulus with intensity in the 8bit range (0-255) to -1 to 1 range.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="group_direction_response" class="doc_header"><code>group_direction_response</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L394" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>group_direction_response</code>(<strong><code>stim_prop</code></strong>, <strong><code>spike_counts</code></strong>, <strong><code>n_repeat</code></strong>, <strong><code>n_cond</code></strong>=<em><code>32</code></em>)</p>
</blockquote>
<p>Group the cells responses from shuffled grating stimulus repetitions. Retrieves a dictionnary
with a key for each condition.</p>
<p>params:</p>

<pre><code>- stim_prop: Grating array of shape (t, 3(size, angle, speed))
- spike_counts: Spike counts response of the cells of shape (t, n_cell)
- n_repeat: Number of repeat of each condition
- n_cond: Total number of condition (speed/size condition * n_angle)

</code></pre>
<p>return:</p>

<pre><code>- dictionnary of the spike counts for each condition (speed/size), with shape (n_angle, n_repeat, len, n_cell)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="group_chirp_bumps" class="doc_header"><code>group_chirp_bumps</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L433" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>group_chirp_bumps</code>(<strong><code>stim_inten</code></strong>, <strong><code>spike_counts</code></strong>, <strong><code>n_repeat</code></strong>)</p>
</blockquote>
<p>Find the cells response to the OFF-ON-OFF initial parts of the chirps.</p>
<p>params:</p>

<pre><code>- stim_inten: Stimulus intensity array
- spike_counts: Spike counts array of shape (t, n_cell)
- n_repeat: Number of repetitions of the chirp stimulus

</code></pre>
<p>return:</p>

<pre><code>- Dictionnary of cells response to the different ON or OFF stimuli</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_repeat_corrected" class="doc_header"><code>get_repeat_corrected</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L486" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_repeat_corrected</code>(<strong><code>stim_inten</code></strong>, <strong><code>spike_counts</code></strong>, <strong><code>n_repeats</code></strong>=<em><code>10</code></em>)</p>
</blockquote>
<p>Apply shifts (detected during synchro) to the chirp repetition.</p>
<p>params:</p>

<pre><code>- stim_inten: Stimulus DataChunk (containing the shifts and frame replacements info)
- spike_counts: Spike count matrix of shape (t, n_cell)
- n_repeats: Number of repeats of the chirp

</code></pre>
<p>return:</p>

<pre><code>- aligned cells response to stimulus, of shape (n_repeat, t, n_cell)
- Number of duplicated frame per repetition.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="removeSlowDrift" class="doc_header"><code>removeSlowDrift</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L525" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>removeSlowDrift</code>(<strong><code>traces</code></strong>, <strong><code>fps</code></strong>=<em><code>60</code></em>, <strong><code>window</code></strong>=<em><code>80</code></em>, <strong><code>percentile</code></strong>=<em><code>8</code></em>)</p>
</blockquote>
<p>Remove slow drifts from behavioral temporal traces such as locomotion speed obtained from the treadmill signal
or pupil size obtained from the eye_tracking signal, by extracting a specified percentile within moving window from the signal.</p>
<p>params:</p>

<pre><code>- traces: Behavioral temporal traces obtained from reM
- fps: Sampling rate
- window: Moving temporal window in seconds
- percentile: Percentile to be extracted within moving window

</code></pre>
<p>return:</p>

<pre><code>- Filtered temporal traces</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="time_shift_test_corr" class="doc_header"><code>time_shift_test_corr</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L559" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>time_shift_test_corr</code>(<strong><code>spike_counts</code></strong>, <strong><code>behav_signal</code></strong>, <strong><code>n_tests</code></strong>=<em><code>500</code></em>, <strong><code>seed</code></strong>=<em><code>1</code></em>)</p>
</blockquote>
<p>Compute the null distribution of correlation between behavioral signal and spiking signal with a time shift test.</p>
<p>params:</p>

<pre><code>- spike_counts: Array with spike counts for a specific neuron and data chunk from the reM
- behav_signal: Array with behavioral signal for a specific neuron and data chunk from the reM
- n_tests: number of used shifted signals to compute distribution
- seed: seed for numpy function random.randint

</code></pre>
<p>return:</p>

<pre><code>- null_dist_corr: Null distribution of correlation values</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cross_corr_with_lag" class="doc_header"><code>cross_corr_with_lag</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L585" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cross_corr_with_lag</code>(<strong><code>spike_counts</code></strong>, <strong><code>behav_signal</code></strong>, <strong><code>behav</code></strong>, <strong><code>conversion_factor_treadmill</code></strong>=<em><code>None</code></em>, <strong><code>removeslowdrift</code></strong>=<em><code>True</code></em>, <strong><code>fps</code></strong>=<em><code>60</code></em>, <strong><code>seconds</code></strong>=<em><code>30</code></em>)</p>
</blockquote>
<p>Compute cross-correlation with lag between behavioral signal and spiking signal.
Process signals, compute null distribution of the correlation with a time shift test and values .
Return cross-correlation array, null-distribution array and values for plotting.</p>
<p>params:</p>

<pre><code>- spike_counts: Array with spike counts for a specific neuron and data chunk from the reM
- behav_signal: Array with behavioral signal for a specific neuron and data chunk from the reM
- behav : String with name of behavioral signal to be analysed
- conversion_factor : The value to convert the treadmill signal into cm/s
- removeslowdrift: Boolean:
    False - doesn't remove slow drifts from the signal
    True - removes slow drifts by extracting a specified percentile within moving window from the signal
- fps: Sampling rate
- seconds: Window in seconds of the correlation lag

</code></pre>
<p>return:</p>

<pre><code>- crosscorr: Cross-correlation with lag array between behavioral signal and spiking signal
- corr_peak: Cross-correlation value at peak synchrony between behavioral signal and spiking signal
- p_value_peak: P-value of the peak cross-correlation value
- offset_peak: Temporal offset of the peak synchrony between behavioral signal and spiking signal in seconds
- null_dist_corr: Null distribution of correlation values (output of 'utils.cross_corr_with_lag')</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_inception_generator" class="doc_header"><code>get_inception_generator</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L642" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_inception_generator</code>(<strong><code>imageset_folder</code></strong>, <strong><code>len_set</code></strong>=<em><code>25</code></em>, <strong><code>width</code></strong>=<em><code>500</code></em>, <strong><code>height</code></strong>=<em><code>281</code></em>)</p>
</blockquote>
<p>Return a function to obtain inception loop images from their index.</p>
<p>params:</p>

<pre><code>- imageset_folder: Path to the folder of the image sets
- len_set: Number of images concatenated per set
- width: image width
</code></pre>
<p>return:</p>

<pre><code>- Function to obtain inception loop images from their index.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="group_omitted_epochs" class="doc_header"><code>group_omitted_epochs</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L671" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>group_omitted_epochs</code>(<strong><code>stim_inten</code></strong>, <strong><code>spike_counts</code></strong>, <strong><code>n_fr_flash</code></strong>=<em><code>4</code></em>, <strong><code>n_fr_interflash</code></strong>=<em><code>4</code></em>, <strong><code>n_fr_isi</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Group the cells reponse to the different omitted stimulus epochs conditions (n_flashes)</p>
<p>params:</p>

<pre><code>- stim_inten: The intensities of the omitted stimulus in shape (t)
- spike_counts: Spikes counts of the cells in shape (t, n_cell)
- n_fr_flash: Duration of a flash (ON flash during OFF baseline, OFF flash during ON baseline)
- n_fr_interflash: Number of frames between two flashes (during an epoch)
- n_fr_isi: Number of frames between two epochs
</code></pre>
<p>return:</p>

<pre><code>- response_d_ON, response_d_OFF: Dictionnaries of the cells responses for different number of flashes repetions. Each contain an array of shape (n_cell, n_repeats, len_epoch+n_fr_isi).</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Plotting-utils">Plotting utils<a class="anchor-link" href="#Plotting-utils"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_shank_channels" class="doc_header"><code>get_shank_channels</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L742" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_shank_channels</code>(<strong><code>channel_positions</code></strong>, <strong><code>shank_dist_th</code></strong>=<em><code>80</code></em>)</p>
</blockquote>
<p>Group the channels of a Buzsaki32 silicone probe into their shanks
from the channel position.</p>
<p>params:</p>

<pre><code>- channel_positions: List of channel positions
- shank_dist_th: Distance between channels in X to rule if on same shank or not

</code></pre>
<p>return:</p>

<pre><code>- array of grouped channel index of shape (n_shank(4), n_channel(8))</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_pval" class="doc_header"><code>format_pval</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L772" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_pval</code>(<strong><code>pval</code></strong>, <strong><code>significant_figures</code></strong>=<em><code>2</code></em>)</p>
</blockquote>
<p>Helper function to format pvalue into string.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="stim_recap_df" class="doc_header"><code>stim_recap_df</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/utils.py#L779" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>stim_recap_df</code>(<strong><code>reM</code></strong>)</p>
</blockquote>
<p>Extract stimuli parameters (originally from the Database) to put them into a
dataframe that will be displayed in the recapitulation plot.</p>
<p>params:</p>

<pre><code>- reM: RecordMaster to extract stimuli parameters from

</code></pre>
<p>return:</p>

<pre><code>- dataframe with the stimuli important informations</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

